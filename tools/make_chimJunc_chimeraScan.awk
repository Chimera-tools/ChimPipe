# ~sdjebali/Awk/cs_bedpe_to_cp_format.awk

# converts a set of chimeric junctions output by chimerascan into a 1 column file proper for benchmark script
# = with header and junctions in chimpipe's format (donchr_doncoord_donstrand:accchr_acccoord_accstrand)


# example
# cd /no_backup/rg/sdjebali/Chimeras/Benchmark/Programs/Chimerascan/Simulated_Chimeras_Normal
# awk -f ~sdjebali/Awk/cs_bedpe_to_cp_format.awk chimeras.bedpe > chimeras_cpformat.tsv

# input
# #chrom5p      start5p end5p   chrom3p start3p end3p   chimera_cluster_id      score   strand5p        strand3p        transcript_ids_5p       transcript_ids_3p       genes5p genes3p type    distance    total_frags      spanning_frags  unique_alignment_positions      isoform_fraction_5p     isoform_fraction_3p     breakpoint_spanning_reads       chimera_ids
# chr11   65820066        65820189        chr11   85367352        85367586        CLUSTER325      38      +       +       ENST00000524475.1:0-123 ENST00000531366.1:483-721,ENST00000532180.1:408-642,ENST00000528105.1:422-655,ENST00000525353.1:525-725,ENST00000304511.2:504-738  SF3B2   TMEM126A        Intrachromosomal        19536255        38      17      380.339285714286   0.155737704918  >40188423/1;pos=508;strand=-,CTGCAGAGCTACACCCGCCAGGTATCAATCAGCTCTGTTACCACACAAAG,>40188483/1;pos=519;strand=-,CACCCGCCAGGTATCAATCAGCTCTGTTACCACACAAAGGGAACATCTTA,>40188424/1;pos=496;strand=-,CTGGTGGAGCGGCTGCAGAGCTACACCCGCCAGGTATCAATCAGCTCTGT,>40188441/2;pos=509;strand=-,TGCAGAGCTACACCCGCCAGGTATCAATCAGCTCTGTTACCACACAAAGG,>40188420/2;pos=505;strand=-,CGGCTGCAGAGCTACACCCGCCAGGTATCAATCAGCTCTGTTACCACACA,>40188449/1;pos=499;strand=-,GTGGAGCGGCTGCAGAGCTACACCCGCCAGGTATCAATCAGCTCTGTTAC,>40188459/1;pos=78;strand=+,TAATCGCGAGGAGCTGGTGGAGCGGCTGCAGAGCTACACCCGCCAGGTAT,>40188442/2;pos=83;strand=+,GCGAGGAGCTGGTGGAGCGGCTGCAGAGCTACACCCGCCAGGTATCAATC,>40188435/2;pos=86;strand=+,AGGAGCTGGTGGAGCGGCTGCAGAGCTACACCCGCCAGGTATCAATCAGC,>40188468/2;pos=87;strand=+,GGAGCTGGTGGAGCGGCTGCAGAGCTACACCCGCCAGGTATCAATCAGCT,>40188472/2;pos=89;strand=+,AGCTGGTGGAGCGGCTGCAGAGCTACACCCGCCAGGTATCAATCAGCTCT,>40188427/2;pos=92;strand=+,TGGTGGAGCGGCTGCAGAGCTACACCCGCCAGGTATCAATCAGCTCTGTT,>40188421/2;pos=97;strand=+,GAGCGGCTGCAGAGCTACACCCGCCAGGTATCAATCAGCTCTGTTACCAC       C0016679,C0016670,C0016672,C0016676,C0016669
# chr3    158387221       158390481       chr3    41978586        41978831        CLUSTER177      38      -       -       ENST00000264265.3:0-584,ENST00000482640.1:0-160 ENST00000414606.1:401-646  LXN     ULK4    Intrachromosomal        -116380580      38      14      38      0.452380952381  0.447058823529  >40236103/1;pos=405;strand=-,TAGAAGCACAAAATATTCCAGGACAGGATTATGGTTGATTACTTCCATGG,>40236090/1;pos=406;strand=-,AGAAGCACAAAATATTCCAGGACAGGATTATGGTTGATTACTTCCATGGA,>40236074/1;pos=399;strand=-,AACCGCTAGAAGCACAAAATATTCCAGGACAGGATTATGGTTGATTACTT,>40236055/1;pos=419;strand=-,ATTCCAGGACAGGATTATGGTTGATTACTTCCATGGATGTACACATGGAC,>40236099/2;pos=395;strand=-,AAGGAACCGCTAGAAGCACAAAATATTCCAGGACAGGATTATGGTTGATT,>40236067/1;pos=404;strand=-,CTAGAAGCACAAAATATTCCAGGACAGGATTATGGTTGATTACTTCCATG,>40236056/2;pos=417;strand=-,ATATTCCAGGACAGGATTATGGTTGATTACTTCCATGGATGTACACATGG,>40236106/2;pos=543;strand=+,TTAAGTCCATGAAGGAACCGCTAGAAGCACAAAATATTCCAGGACAGGAT,>40236064/1;pos=548;strand=+,TCCATGAAGGAACCGCTAGAAGCACAAAATATTCCAGGACAGGATTATGG,>40236030/1;pos=550;strand=+,CATGAAGGAACCGCTAGAAGCACAAAATATTCCAGGACAGGATTATGGTT,>40236102/2;pos=553;strand=+,GAAGGAACCGCTAGAAGCACAAAATATTCCAGGACAGGATTATGGTTGAT        C0001057,C0013345
# 9 (22 fields)
# 327 (23 fields)

# output
# junc_id
# chr11_65820189_+:chr11_85367353_+
# chr3_158387222_-:chr3_41978831_-
# 336 (1 fields)  *** seems to be working

NR==1{
    print "junc_id";
}
NR>=2{
    print $1"_"($9=="+" ? $3 : ($2+1))"_"$9":"$4"_"($10=="+" ? ($5+1) : $6)"_"$10;
}